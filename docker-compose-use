#!/bin/sh

# Run this preprocessor when the configuration changes to
# regenerate the .env file for docker-compose

# Step 1. Lines with a single '# ' are removed completely)
# This allows commenting to work within a series of \ separated lines
## lines to survive this filter.

grep -v "^# " $1 > /tmp/env1

# Step 2. Whitespace is trimmed
sed -i 's/^ *//;s/ *$//' /tmp/env1

# Step 3. Lines ending in \ are concatenated
awk '{if (sub(/\\$/,"")) printf "%s", $0; else print $0}' /tmp/env1 > .env
